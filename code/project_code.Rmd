---
title: "Final Project Code"
author: "Samuel Leung"
output: pdf_document
date: "`r Sys.Date()`"
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Load Libraries}
source("lp_optimize.R")
```

```{r Project setup with rocket example}
n <- 5
realizations <- 0:n/n
prior_probabilities <- realizations * (1-realizations)

posterior_calc <- function(prior, realizations, successes = 1, n_obs = 1) {
  joint <- prior * dbinom(x = successes, size = n_obs, p = realizations)
  return(joint / sum(joint))
}

posteriors <- posterior_calc(prior = prior_probabilities,
                             realizations = realizations)
```

```{r distance functions}
absolute_dist <- function(from, to) return(abs(to - from))
```

```{r one run of next_index}
# next_index(2, posteriors, realizations, absolute_dist)
sol = lp_optimize(posteriors = posteriors, realizations = realizations, dist = absolute_dist)
get_solution_matrix(sol, length(posteriors))
```

```{r}
next_index(2, posteriors, realizations, absolute_dist)
```


```{r Putting it all together}
# function to sample posterior + indexes for rocket example. Start index at 
# 2, as index 1 is where the posterior = 0
rocket_sampling <- function(indices, n_successes, n_obs, dist, curr_index = 2 , n_iter = 10) {
  ret.indices = rep(NA, n_iter)
  
  realizations = 0:indices / indices
  prior.probabilities = realizations * (1-realizations)
  
  for (i in 1:n_iter) {
    joint = prior.probabilities * dbinom(x = n_successes, size = n_obs, p = realizations)
    posteriors = joint / sum(joint)
    next.index = next_index(curr_index = curr_index, posteriors = posteriors , 
                            realizations = realizations, dist = dist)
    ret.indices[i] = next.index
    curr_index = next.index
    
    # perfrom gibbs sampler under new curr_index
    
    # update observations. Not sure if this is what i'm supposed to do. 
    # outcome = rbinom(1,1,realizations[curr_index])
    # n_obs = n_obs + 1
    # n_successes = n_successes + outcome
    # ret.samples[i] = rbinom(1,1,)
  }
  return(ret.indices)
}

rocket_sampling(5, 1, 1, curr_index = 3, absolute_dist, n_iter = 10)
```

```{r debug time}
# sol = lp_optimize(posteriors=posteriors, realizations=realizations, dist=absolute_dist)
# matrix(sol$solution, nrow=length(posteriors), byrow=TRUE)
f.obj <- c(1, 9, 1)
f.con <- matrix (c(1, 2, 3, 3, 2, 2), nrow=2, byrow=TRUE)
f.dir <- c("<=", "<=")
f.rhs <- c(9, 15)
sol=lp ("max", f.obj, f.con, f.dir, f.rhs)
```





